<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>哪吒的深入理解全栈系列</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/learn-web/logo.jpg">
    <meta name="description" content="「早起、阅读、运动、写作、冥想」">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/learn-web/assets/css/0.styles.b695ea6c.css" as="style"><link rel="preload" href="/learn-web/assets/js/app.72a02f74.js" as="script"><link rel="preload" href="/learn-web/assets/js/2.a6c2d1f7.js" as="script"><link rel="preload" href="/learn-web/assets/js/56.2dee655f.js" as="script"><link rel="prefetch" href="/learn-web/assets/js/10.aaeca20e.js"><link rel="prefetch" href="/learn-web/assets/js/100.f7f95db7.js"><link rel="prefetch" href="/learn-web/assets/js/101.4ef9fb19.js"><link rel="prefetch" href="/learn-web/assets/js/102.a8fa7673.js"><link rel="prefetch" href="/learn-web/assets/js/103.2af2839e.js"><link rel="prefetch" href="/learn-web/assets/js/104.9e751296.js"><link rel="prefetch" href="/learn-web/assets/js/105.6f63235e.js"><link rel="prefetch" href="/learn-web/assets/js/106.b8d4d6af.js"><link rel="prefetch" href="/learn-web/assets/js/107.91de7f35.js"><link rel="prefetch" href="/learn-web/assets/js/108.09092da0.js"><link rel="prefetch" href="/learn-web/assets/js/109.b003cdf0.js"><link rel="prefetch" href="/learn-web/assets/js/11.d9bf61c5.js"><link rel="prefetch" href="/learn-web/assets/js/110.972614dd.js"><link rel="prefetch" href="/learn-web/assets/js/111.33108f14.js"><link rel="prefetch" href="/learn-web/assets/js/112.70827e82.js"><link rel="prefetch" href="/learn-web/assets/js/113.2fb223e9.js"><link rel="prefetch" href="/learn-web/assets/js/114.0695cb59.js"><link rel="prefetch" href="/learn-web/assets/js/115.ac904829.js"><link rel="prefetch" href="/learn-web/assets/js/116.647d1960.js"><link rel="prefetch" href="/learn-web/assets/js/117.cb088bd8.js"><link rel="prefetch" href="/learn-web/assets/js/118.a87b4044.js"><link rel="prefetch" href="/learn-web/assets/js/119.5ae7379d.js"><link rel="prefetch" href="/learn-web/assets/js/12.67199060.js"><link rel="prefetch" href="/learn-web/assets/js/120.3e5dd68e.js"><link rel="prefetch" href="/learn-web/assets/js/121.1c6720b8.js"><link rel="prefetch" href="/learn-web/assets/js/122.58d871ec.js"><link rel="prefetch" href="/learn-web/assets/js/123.52450eb8.js"><link rel="prefetch" href="/learn-web/assets/js/124.72bfff1d.js"><link rel="prefetch" href="/learn-web/assets/js/125.b367826d.js"><link rel="prefetch" href="/learn-web/assets/js/13.666a623d.js"><link rel="prefetch" href="/learn-web/assets/js/14.9eb30dde.js"><link rel="prefetch" href="/learn-web/assets/js/15.1f3fea0d.js"><link rel="prefetch" href="/learn-web/assets/js/16.7311dc90.js"><link rel="prefetch" href="/learn-web/assets/js/17.c3d8066f.js"><link rel="prefetch" href="/learn-web/assets/js/18.1d44600d.js"><link rel="prefetch" href="/learn-web/assets/js/19.01366c26.js"><link rel="prefetch" href="/learn-web/assets/js/20.903f0ed3.js"><link rel="prefetch" href="/learn-web/assets/js/21.e5e7efdf.js"><link rel="prefetch" href="/learn-web/assets/js/22.1c09ae3a.js"><link rel="prefetch" href="/learn-web/assets/js/23.d7d52d9c.js"><link rel="prefetch" href="/learn-web/assets/js/24.110f3791.js"><link rel="prefetch" href="/learn-web/assets/js/25.cdcc627e.js"><link rel="prefetch" href="/learn-web/assets/js/26.0a33d9a0.js"><link rel="prefetch" href="/learn-web/assets/js/27.5688e4bf.js"><link rel="prefetch" href="/learn-web/assets/js/28.9b3bc35f.js"><link rel="prefetch" href="/learn-web/assets/js/29.7a9f1587.js"><link rel="prefetch" href="/learn-web/assets/js/3.4ad85264.js"><link rel="prefetch" href="/learn-web/assets/js/30.8e259062.js"><link rel="prefetch" href="/learn-web/assets/js/31.4a4cbdc5.js"><link rel="prefetch" href="/learn-web/assets/js/32.69d26ab6.js"><link rel="prefetch" href="/learn-web/assets/js/33.da90182b.js"><link rel="prefetch" href="/learn-web/assets/js/34.5283b3b6.js"><link rel="prefetch" href="/learn-web/assets/js/35.69ad09b2.js"><link rel="prefetch" href="/learn-web/assets/js/36.675454cd.js"><link rel="prefetch" href="/learn-web/assets/js/37.079f4c43.js"><link rel="prefetch" href="/learn-web/assets/js/38.413a26c0.js"><link rel="prefetch" href="/learn-web/assets/js/39.05c8e713.js"><link rel="prefetch" href="/learn-web/assets/js/4.5434103e.js"><link rel="prefetch" href="/learn-web/assets/js/40.e8aac23e.js"><link rel="prefetch" href="/learn-web/assets/js/41.4fe62ded.js"><link rel="prefetch" href="/learn-web/assets/js/42.1dc095df.js"><link rel="prefetch" href="/learn-web/assets/js/43.416de164.js"><link rel="prefetch" href="/learn-web/assets/js/44.941ced0d.js"><link rel="prefetch" href="/learn-web/assets/js/45.abcf4033.js"><link rel="prefetch" href="/learn-web/assets/js/46.738ce4d2.js"><link rel="prefetch" href="/learn-web/assets/js/47.9f1f7cf6.js"><link rel="prefetch" href="/learn-web/assets/js/48.ace0f5b0.js"><link rel="prefetch" href="/learn-web/assets/js/49.05ec783f.js"><link rel="prefetch" href="/learn-web/assets/js/5.592e78f1.js"><link rel="prefetch" href="/learn-web/assets/js/50.3c564ee7.js"><link rel="prefetch" href="/learn-web/assets/js/51.5889851c.js"><link rel="prefetch" href="/learn-web/assets/js/52.ac6e1a2b.js"><link rel="prefetch" href="/learn-web/assets/js/53.706b3e57.js"><link rel="prefetch" href="/learn-web/assets/js/54.639035df.js"><link rel="prefetch" href="/learn-web/assets/js/55.7403f743.js"><link rel="prefetch" href="/learn-web/assets/js/57.b64a6d6c.js"><link rel="prefetch" href="/learn-web/assets/js/58.c770ea8b.js"><link rel="prefetch" href="/learn-web/assets/js/59.704e30b9.js"><link rel="prefetch" href="/learn-web/assets/js/6.daf19e12.js"><link rel="prefetch" href="/learn-web/assets/js/60.0cb848cc.js"><link rel="prefetch" href="/learn-web/assets/js/61.478b6ecd.js"><link rel="prefetch" href="/learn-web/assets/js/62.226b7ec3.js"><link rel="prefetch" href="/learn-web/assets/js/63.a1e93f97.js"><link rel="prefetch" href="/learn-web/assets/js/64.47e06a47.js"><link rel="prefetch" href="/learn-web/assets/js/65.616b074f.js"><link rel="prefetch" href="/learn-web/assets/js/66.8fdb2e03.js"><link rel="prefetch" href="/learn-web/assets/js/67.5cfd0463.js"><link rel="prefetch" href="/learn-web/assets/js/68.1ef8eeb1.js"><link rel="prefetch" href="/learn-web/assets/js/69.ce28eb58.js"><link rel="prefetch" href="/learn-web/assets/js/7.d040c705.js"><link rel="prefetch" href="/learn-web/assets/js/70.b44d988f.js"><link rel="prefetch" href="/learn-web/assets/js/71.dbf935bb.js"><link rel="prefetch" href="/learn-web/assets/js/72.5624555b.js"><link rel="prefetch" href="/learn-web/assets/js/73.2c9d9dfd.js"><link rel="prefetch" href="/learn-web/assets/js/74.17f107fd.js"><link rel="prefetch" href="/learn-web/assets/js/75.9a48455f.js"><link rel="prefetch" href="/learn-web/assets/js/76.2dc8eb1d.js"><link rel="prefetch" href="/learn-web/assets/js/77.85af0b7b.js"><link rel="prefetch" href="/learn-web/assets/js/78.31ef44df.js"><link rel="prefetch" href="/learn-web/assets/js/79.72c1b27a.js"><link rel="prefetch" href="/learn-web/assets/js/8.090e429e.js"><link rel="prefetch" href="/learn-web/assets/js/80.20ab9560.js"><link rel="prefetch" href="/learn-web/assets/js/81.91d0896a.js"><link rel="prefetch" href="/learn-web/assets/js/82.4f44e777.js"><link rel="prefetch" href="/learn-web/assets/js/83.41d6c718.js"><link rel="prefetch" href="/learn-web/assets/js/84.85fe028b.js"><link rel="prefetch" href="/learn-web/assets/js/85.bc78a728.js"><link rel="prefetch" href="/learn-web/assets/js/86.6ec9ca4c.js"><link rel="prefetch" href="/learn-web/assets/js/87.8925b716.js"><link rel="prefetch" href="/learn-web/assets/js/88.7b38907d.js"><link rel="prefetch" href="/learn-web/assets/js/89.a65dfe2a.js"><link rel="prefetch" href="/learn-web/assets/js/9.231751c5.js"><link rel="prefetch" href="/learn-web/assets/js/90.f4b5d07c.js"><link rel="prefetch" href="/learn-web/assets/js/91.9a937d66.js"><link rel="prefetch" href="/learn-web/assets/js/92.774dfff6.js"><link rel="prefetch" href="/learn-web/assets/js/93.1b9fbed3.js"><link rel="prefetch" href="/learn-web/assets/js/94.eea33475.js"><link rel="prefetch" href="/learn-web/assets/js/95.1608b684.js"><link rel="prefetch" href="/learn-web/assets/js/96.77ff819f.js"><link rel="prefetch" href="/learn-web/assets/js/97.b0d7dcc6.js"><link rel="prefetch" href="/learn-web/assets/js/98.b598e00f.js"><link rel="prefetch" href="/learn-web/assets/js/99.b04a0d52.js">
    <link rel="stylesheet" href="/learn-web/assets/css/0.styles.b695ea6c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-web/" class="home-link router-link-active"><!----> <span class="site-name">哪吒的深入理解全栈系列</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn-web/HTML/" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/learn-web/CSS/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/learn-web/JavaScript/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/learn-web/HTTP/" class="nav-link">
  HTTP
</a></div><div class="nav-item"><a href="/learn-web/front-end-engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/learn-web/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">大前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="大前端" class="mobile-dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-web/regular-expression/" class="nav-link">
  正则表达式
</a></li><li class="dropdown-item"><!----> <a href="/learn-web/Programming/" class="nav-link">
  编程题
</a></li><li class="dropdown-item"><!----> <a href="/learn-web/Node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/learn-web/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/learn-web/React/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践" class="dropdown-title"><span class="title">实践</span> <span class="arrow down"></span></button> <button type="button" aria-label="实践" class="mobile-dropdown-title"><span class="title">实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          html-css-js实践
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/html-css-js-coding/" class="nav-link">
  html-css-js实践
</a></li></ul></li><li class="dropdown-item"><h4>
          实践操作
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/coding/" class="nav-link">
  实践操作
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="书籍" class="dropdown-title"><span class="title">书籍</span> <span class="arrow down"></span></button> <button type="button" aria-label="书籍" class="mobile-dropdown-title"><span class="title">书籍</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JavaScript书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/JavaScript-advanced-programming/" class="nav-link router-link-active">
  JavaScript高级程序设计（第4版）
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/APIs/" class="nav-link">
  APIs
</a></li><li class="dropdown-subitem"><a href="/learn-web/Browser-Extensions/" class="nav-link">
  Browser-Extensions
</a></li><li class="dropdown-subitem"><a href="/learn-web/Java/" class="nav-link">
  Java
</a></li></ul></li><li class="dropdown-item"><h4>
          高阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/safety/" class="nav-link">
  安全系列
</a></li><li class="dropdown-subitem"><a href="/learn-web/Performance/" class="nav-link">
  性能系列
</a></li></ul></li><li class="dropdown-item"><h4>
          资深
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/DataStructure/" class="nav-link">
  数据结构系列
</a></li><li class="dropdown-subitem"><a href="/learn-web/ALG/" class="nav-link">
  算法系列
</a></li></ul></li><li class="dropdown-item"><h4>
          推荐
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://learn-docs.github.io/learn-webpack/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  learn-webpack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://learn-docs.github.io/learn-React/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  learn-React
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://learn-docs.github.io/learn-TypeScript/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  learn-TypeScript
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://1024bibi.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1024bibi.com bolg
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://learn-docs.github.io/vue-docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue-docs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/webVueBlog/learn-web" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/learn-web/HTML/" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/learn-web/CSS/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/learn-web/JavaScript/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/learn-web/HTTP/" class="nav-link">
  HTTP
</a></div><div class="nav-item"><a href="/learn-web/front-end-engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/learn-web/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">大前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="大前端" class="mobile-dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-web/regular-expression/" class="nav-link">
  正则表达式
</a></li><li class="dropdown-item"><!----> <a href="/learn-web/Programming/" class="nav-link">
  编程题
</a></li><li class="dropdown-item"><!----> <a href="/learn-web/Node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/learn-web/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/learn-web/React/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践" class="dropdown-title"><span class="title">实践</span> <span class="arrow down"></span></button> <button type="button" aria-label="实践" class="mobile-dropdown-title"><span class="title">实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          html-css-js实践
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/html-css-js-coding/" class="nav-link">
  html-css-js实践
</a></li></ul></li><li class="dropdown-item"><h4>
          实践操作
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/coding/" class="nav-link">
  实践操作
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="书籍" class="dropdown-title"><span class="title">书籍</span> <span class="arrow down"></span></button> <button type="button" aria-label="书籍" class="mobile-dropdown-title"><span class="title">书籍</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JavaScript书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/JavaScript-advanced-programming/" class="nav-link router-link-active">
  JavaScript高级程序设计（第4版）
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/APIs/" class="nav-link">
  APIs
</a></li><li class="dropdown-subitem"><a href="/learn-web/Browser-Extensions/" class="nav-link">
  Browser-Extensions
</a></li><li class="dropdown-subitem"><a href="/learn-web/Java/" class="nav-link">
  Java
</a></li></ul></li><li class="dropdown-item"><h4>
          高阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/safety/" class="nav-link">
  安全系列
</a></li><li class="dropdown-subitem"><a href="/learn-web/Performance/" class="nav-link">
  性能系列
</a></li></ul></li><li class="dropdown-item"><h4>
          资深
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-web/DataStructure/" class="nav-link">
  数据结构系列
</a></li><li class="dropdown-subitem"><a href="/learn-web/ALG/" class="nav-link">
  算法系列
</a></li></ul></li><li class="dropdown-item"><h4>
          推荐
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://learn-docs.github.io/learn-webpack/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  learn-webpack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://learn-docs.github.io/learn-React/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  learn-React
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://learn-docs.github.io/learn-TypeScript/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  learn-TypeScript
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://1024bibi.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1024bibi.com bolg
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://learn-docs.github.io/vue-docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue-docs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/webVueBlog/learn-web" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/learn-web/JavaScript-advanced-programming/" class="sidebar-heading clickable router-link-active open"><span>JavaScript高级程序设计（第4版）</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-web/JavaScript-advanced-programming/1章-什么是JavaScript.html" class="sidebar-link">1章-什么是JavaScript</a></li><li><a href="/learn-web/JavaScript-advanced-programming/2章-HTML中的JavaScript.html" class="sidebar-link">2章-HTML中的JavaScript</a></li><li><a href="/learn-web/JavaScript-advanced-programming/3章-语言基础.html" class="sidebar-link">3章-语言基础</a></li><li><a href="/learn-web/JavaScript-advanced-programming/4章-变量与作用域与内存.html" class="sidebar-link">4章-变量与作用域与内存</a></li><li><a href="/learn-web/JavaScript-advanced-programming/5章-基本引用类型.html" class="sidebar-link">5章-基本引用类型</a></li><li><a href="/learn-web/JavaScript-advanced-programming/6章-集合引用类型.html" class="sidebar-link">6章-集合引用类型</a></li><li><a href="/learn-web/JavaScript-advanced-programming/7章-迭代器与生成器.html" class="sidebar-link">7章-迭代器与生成器</a></li><li><a href="/learn-web/JavaScript-advanced-programming/8章-对象与类与面向对象编程.html" class="sidebar-link">8章-对象与类与面向对象编程</a></li><li><a href="/learn-web/JavaScript-advanced-programming/9章-代理与反射.html" class="sidebar-link">9章-代理与反射</a></li><li><a href="/learn-web/JavaScript-advanced-programming/10章-函数.html" class="sidebar-link">10章-函数</a></li><li><a href="/learn-web/JavaScript-advanced-programming/11章-期约与异步函数.html" class="sidebar-link">11章-期约与异步函数</a></li><li><a href="/learn-web/JavaScript-advanced-programming/12章-BOM.html" class="sidebar-link">12章-BOM</a></li><li><a href="/learn-web/JavaScript-advanced-programming/13章-客户端检测.html" class="sidebar-link">13章-客户端检测</a></li><li><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html" class="active sidebar-link">14章-DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#内容" class="sidebar-link">内容</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#节点层级" class="sidebar-link">节点层级</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#node类型" class="sidebar-link">Node类型</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#nodename-与-nodevalue" class="sidebar-link">nodeName 与 nodeValue</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#节点关系" class="sidebar-link">节点关系</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#方法-haschildnodes" class="sidebar-link">方法 hasChildNodes()</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#操纵节点" class="sidebar-link">操纵节点</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#移除节点-使用-removechild-方法" class="sidebar-link">移除节点 使用 removeChild()方法</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#normalize" class="sidebar-link">normalize()</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#document-类型" class="sidebar-link">Document 类型</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#文档子节点" class="sidebar-link">文档子节点</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#文档信息" class="sidebar-link">文档信息</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#定位元素" class="sidebar-link">定位元素</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#特殊集合" class="sidebar-link">特殊集合</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#dom-兼容性检测" class="sidebar-link">DOM 兼容性检测</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#文档写入" class="sidebar-link">文档写入</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#element-类型" class="sidebar-link">Element 类型</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#html-元素" class="sidebar-link">HTML 元素</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#取得属性" class="sidebar-link">取得属性</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#设置属性" class="sidebar-link">设置属性</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#attributes-属性" class="sidebar-link">attributes 属性</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#创建元素" class="sidebar-link">创建元素</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#元素后代" class="sidebar-link">元素后代</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#text-类型" class="sidebar-link">Text 类型</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#创建文本节点" class="sidebar-link">创建文本节点</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#规范化文本节点" class="sidebar-link">规范化文本节点</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#拆分文本节点" class="sidebar-link">拆分文本节点</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#comment-类型" class="sidebar-link">Comment 类型</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#cdatasection-类型" class="sidebar-link">CDATASection 类型</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#documenttype-类型" class="sidebar-link">DocumentType 类型</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#documentfragment-类型" class="sidebar-link">DocumentFragment 类型</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#attr-类型" class="sidebar-link">Attr 类型</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#dom-编程" class="sidebar-link">DOM 编程</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#动态样式" class="sidebar-link">动态样式</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#操作表格" class="sidebar-link">操作表格</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#使用-nodelist" class="sidebar-link">使用 NodeList</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#mutationobserver-接口" class="sidebar-link">MutationObserver 接口</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#重用-mutationobserver" class="sidebar-link">重用 MutationObserver</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#观察属性" class="sidebar-link">观察属性</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#观察字符数据" class="sidebar-link">观察字符数据</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#观察子节点" class="sidebar-link">观察子节点</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#观察子树" class="sidebar-link">观察子树</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#异步回调与记录队列" class="sidebar-link">异步回调与记录队列</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#记录队列" class="sidebar-link">记录队列</a></li><li class="sidebar-sub-header"><a href="/learn-web/JavaScript-advanced-programming/14章-DOM.html#性能、内存与垃圾回收" class="sidebar-link">性能、内存与垃圾回收</a></li></ul></li><li><a href="/learn-web/JavaScript-advanced-programming/15章-DOM扩展.html" class="sidebar-link">15章-DOM扩展</a></li><li><a href="/learn-web/JavaScript-advanced-programming/16章-DOM2和DOM3.html" class="sidebar-link">16章-DOM2和DOM3</a></li><li><a href="/learn-web/JavaScript-advanced-programming/17章-事件.html" class="sidebar-link">17章-事件</a></li><li><a href="/learn-web/JavaScript-advanced-programming/18章-动画与Canvas图形.html" class="sidebar-link">18章-动画与Canvas图形</a></li><li><a href="/learn-web/JavaScript-advanced-programming/19章-表单脚本.html" class="sidebar-link">19章-表单脚本</a></li><li><a href="/learn-web/JavaScript-advanced-programming/20章-JavaScriptAPI.html" class="sidebar-link">20章-JavaScriptAPI</a></li><li><a href="/learn-web/JavaScript-advanced-programming/21章-错误处理与调试.html" class="sidebar-link">21章-错误处理与调试</a></li><li><a href="/learn-web/JavaScript-advanced-programming/22章-处理XML.html" class="sidebar-link">22章-处理XML</a></li><li><a href="/learn-web/JavaScript-advanced-programming/23章-JSON.html" class="sidebar-link">23章-JSON</a></li><li><a href="/learn-web/JavaScript-advanced-programming/24章-网络请求与远程资源.html" class="sidebar-link">24章-网络请求与远程资源</a></li><li><a href="/learn-web/JavaScript-advanced-programming/25章-客户端存储.html" class="sidebar-link">25章-客户端存储</a></li><li><a href="/learn-web/JavaScript-advanced-programming/26章-模块.html" class="sidebar-link">26章-模块</a></li><li><a href="/learn-web/JavaScript-advanced-programming/27章-工作者线程.html" class="sidebar-link">27章-工作者线程</a></li><li><a href="/learn-web/JavaScript-advanced-programming/28章-最佳实践.html" class="sidebar-link">28章-最佳实践</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>点击勘误<a href="https://github.com/webVueBlog/learn-web/issues" target="_blank" rel="noopener noreferrer">issues<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，哪吒感谢大家的阅读</p></blockquote> <p></p><div class="table-of-contents"><ul><li><a href="#内容">内容</a></li><li><a href="#节点层级">节点层级</a></li><li><a href="#node类型">Node类型</a></li><li><a href="#nodename-与-nodevalue">nodeName 与 nodeValue</a></li><li><a href="#节点关系">节点关系</a></li><li><a href="#方法-haschildnodes">方法 hasChildNodes()</a></li><li><a href="#操纵节点">操纵节点</a></li><li><a href="#移除节点-使用-removechild-方法">移除节点 使用 removeChild()方法</a></li><li><a href="#normalize">normalize()</a></li><li><a href="#document-类型">Document 类型</a></li><li><a href="#文档子节点">文档子节点</a></li><li><a href="#文档信息">文档信息</a></li><li><a href="#定位元素">定位元素</a></li><li><a href="#特殊集合">特殊集合</a></li><li><a href="#dom-兼容性检测">DOM 兼容性检测</a></li><li><a href="#文档写入">文档写入</a></li><li><a href="#element-类型">Element 类型</a></li><li><a href="#html-元素">HTML 元素</a></li><li><a href="#取得属性">取得属性</a></li><li><a href="#设置属性">设置属性</a></li><li><a href="#attributes-属性">attributes 属性</a></li><li><a href="#创建元素">创建元素</a></li><li><a href="#元素后代">元素后代</a></li><li><a href="#text-类型">Text 类型</a></li><li><a href="#创建文本节点">创建文本节点</a></li><li><a href="#规范化文本节点">规范化文本节点</a></li><li><a href="#拆分文本节点">拆分文本节点</a></li><li><a href="#comment-类型">Comment 类型</a></li><li><a href="#cdatasection-类型">CDATASection 类型</a></li><li><a href="#documenttype-类型">DocumentType 类型</a></li><li><a href="#documentfragment-类型">DocumentFragment 类型</a></li><li><a href="#attr-类型">Attr 类型</a></li><li><a href="#dom-编程">DOM 编程</a><ul><li><a href="#动态脚本">动态脚本</a></li></ul></li><li><a href="#动态样式">动态样式</a></li><li><a href="#操作表格">操作表格</a></li><li><a href="#使用-nodelist">使用 NodeList</a></li><li><a href="#mutationobserver-接口">MutationObserver 接口</a><ul><li><a href="#基本用法">基本用法</a></li><li><a href="#observe-方法">observe()方法</a></li><li><a href="#回调与-mutationrecord">回调与 MutationRecord</a></li><li><a href="#disconnect-方法">disconnect()方法</a></li><li><a href="#复用-mutationobserver">复用 MutationObserver</a></li></ul></li><li><a href="#重用-mutationobserver">重用 MutationObserver</a><ul><li><a href="#mutationobserverinit-与观察范围">MutationObserverInit 与观察范围</a></li></ul></li><li><a href="#观察属性">观察属性</a></li><li><a href="#观察字符数据">观察字符数据</a></li><li><a href="#观察子节点">观察子节点</a></li><li><a href="#观察子树">观察子树</a></li><li><a href="#异步回调与记录队列">异步回调与记录队列</a></li><li><a href="#记录队列">记录队列</a><ul><li><a href="#takerecords-方法">takeRecords()方法</a></li></ul></li><li><a href="#性能、内存与垃圾回收">性能、内存与垃圾回收</a></li></ul></div><p></p> <h2 id="内容"><a href="#内容" class="header-anchor">#</a> 内容</h2> <ol><li>理解文档对象模型（DOM）的构成</li> <li>节点类型</li> <li>浏览器兼容性</li> <li>MutationObserver 接口</li></ol> <blockquote><p>文档对象模型（DOM，Document Object Model）是 HTML 和 XML 文档的编程接口。</p></blockquote> <ol><li>DOM 表示由多层节点构成的文档，通过它开发者可以添加、删除和修改页面的各个部分。</li> <li>DOM 现在是真正跨平台、语言无关的表示和操作网页的方式。</li></ol> <p>JavaScript 中提供了 DOM API。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意 IE8 及更低版本中的 DOM 是通过 COM 对象实现的。这意味着这些版本的 IE 中，
DOM 对象跟原生 JavaScript 对象具有不同的行为和功能。</p></div> <h2 id="节点层级"><a href="#节点层级" class="header-anchor">#</a> 节点层级</h2> <p>任何 HTML 或 XML 文档都可以用 DOM 表示为一个由节点构成的层级结构。</p> <ol><li>document 节点表示每个文档的根节点。</li> <li>根节点的唯一子节点是<code>&lt;html&gt;</code>元素，我们称之为文档元素（documentElement）</li> <li>文档元素是文档最外层的元素，所有其他元素都存在于这个元素之内。</li> <li>每个文档只能有一个文档元素。</li> <li>在 HTML 页面中，文档元素始终是<code>&lt;html&gt;</code>元素。在 XML 文档中，则没有这样预定义的元素，任何元素都可能成为文档元素。</li> <li>DOM 中总共有 12 种节点类型，这些类型都继承一种基本类型。</li></ol> <h2 id="node类型"><a href="#node类型" class="header-anchor">#</a> Node类型</h2> <p>每个节点都有 nodeType 属性，表示该节点的类型。节点类型由定义在 Node 类型上的 12 个数值
常量表示：</p> <ul><li>Node.ELEMENT_NODE（1） - element_node</li> <li>Node.ATTRIBUTE_NODE（2） - attribute_node</li> <li>Node.TEXT_NODE（3） - text_node</li> <li>Node.CDATA_SECTION_NODE（4）cdata_section_node</li> <li>Node.ENTITY_REFERENCE_NODE（5） entity_reference_node</li> <li>Node.ENTITY_NODE（6） entity_node</li> <li>Node.PROCESSING_INSTRUCTION_NODE（7） processing_instruction_node</li> <li>Node.COMMENT_NODE（8） comment_node</li> <li>Node.DOCUMENT_NODE（9） document_node</li> <li>Node.DOCUMENT_TYPE_NODE（10） document_type_node</li> <li>Node.DOCUMENT_FRAGMENT_NODE（11） document_fragment_node</li> <li>Node.NOTATION_NODE（12）notation_node</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>someNode<span class="token punctuation">.</span>nodeType <span class="token operator">==</span> Node<span class="token punctuation">.</span><span class="token constant">ELEMENT_NODE</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Node is an element.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 元素节点</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="nodename-与-nodevalue"><a href="#nodename-与-nodevalue" class="header-anchor">#</a> nodeName 与 nodeValue</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>someNode<span class="token punctuation">.</span>nodeType <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 value <span class="token operator">=</span> someNode<span class="token punctuation">.</span>nodeName<span class="token punctuation">;</span> <span class="token comment">// 会显示元素的标签名</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="节点关系"><a href="#节点关系" class="header-anchor">#</a> 节点关系</h2> <ol><li>每个节点都有一个 childNodes 属性，其中包含一个 NodeList 的实例。</li> <li>NodeList 是一个类数组对象，用于存储可以按位置存取的有序节点。</li> <li>注意，NodeList 并不是 Array 的实例，但可以使用中括号访问它的值，而且它也有 length 属性。</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>NodeList 对象独特的地方在于，它其实是一个对 DOM 结构的查询，因此 DOM 结构的变化会自动地在 NodeList 中反映出来。
我们通常说 NodeList 是实时的活动对象，而不是第一次访问时所获得内容的快照。</p></div> <p>访问 NodeList 中的元素：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> firstChild <span class="token operator">=</span> someNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> secondChild <span class="token operator">=</span> someNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> count <span class="token operator">=</span> someNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>转换为数组。比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arrayOfNodes <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>someNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用 ES6 的 Array.from()静态方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arrayOfNodes <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>someNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol><li>每个节点都有一个 parentNode 属性，指向其 DOM 树中的父元素。</li> <li>childNodes 中的所有节点都有同一个父元素，因此它们的 parentNode 属性都指向同一个节点。</li> <li>childNodes 列表中的每个节点都是同一列表中其他节点的同胞节点。</li> <li>使用 previousSibling 和 nextSibling 可以在这个列表的节点间导航。</li> <li>这个列表中第一个节点的 previousSibling 属性是 null，最后一个节点的nextSibling 属性也是 null</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意，如果 childNodes 中只有一个节点，则它的 previousSibling 和 nextSibling 属性都是
null。</p></div> <ol><li>父节点和它的第一个及最后一个子节点也有专门属性：firstChild 和 lastChild 分别指向childNodes 中的第一个和最后一个子节点。</li> <li>someNode.firstChild 的值始终等于 someNode.childNodes[0]，而 someNode.lastChild 的值始终等于 someNode.childNodes[someNode.childNodes.length-1]。</li> <li>如果只有一个子节点，则 firstChild 和 lastChild 指向同一个节点。</li> <li>如果没有子节点，则 firstChild 和 lastChild 都是 null。</li></ol> <h2 id="方法-haschildnodes"><a href="#方法-haschildnodes" class="header-anchor">#</a> 方法 hasChildNodes()</h2> <p>hasChildNodes()，这个方法如果返回 true 则说明节点有一个或多个子节点。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意 虽然所有节点类型都继承了 Node，但并非所有节点都有子节点。</p></div> <p>有一个所有节点都共享的关系。ownerDocument 属性是一个指向代表整个文档的文档节点
的指针。因为一个节点不可能同时存在于两个或者多个文档中。</p> <h2 id="操纵节点"><a href="#操纵节点" class="header-anchor">#</a> 操纵节点</h2> <ol><li>appendChild()，用于在 childNodes 列表末尾添加节点。</li> <li>appendChild()方法返回新添加的节点。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> returnedNode <span class="token operator">=</span> someNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>returnedNode <span class="token operator">==</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>
<span class="token function">alert</span><span class="token punctuation">(</span>someNode<span class="token punctuation">.</span>lastChild <span class="token operator">==</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>如果把文档中已经存在的节点传给 appendChild()，则这个节点会从之前的位置被转移到新位置。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 假设 someNode 有多个子节点</span>
<span class="token keyword">let</span> returnedNode <span class="token operator">=</span> someNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>someNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>returnedNode <span class="token operator">==</span> someNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span>
<span class="token function">alert</span><span class="token punctuation">(</span>returnedNode <span class="token operator">==</span> someNode<span class="token punctuation">.</span>lastChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>把节点放到 childNodes 中的特定位置</p></blockquote> <p>使用 insertBefore()方法。这个方法接收两个参数：要插入的节点和参照节点。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 作为最后一个子节点插入</span>
returnedNode <span class="token operator">=</span> someNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>newNode <span class="token operator">==</span> someNode<span class="token punctuation">.</span>lastChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>
<span class="token comment">// 作为新的第一个子节点插入</span>
returnedNode <span class="token operator">=</span> someNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> someNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>returnedNode <span class="token operator">==</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>
<span class="token function">alert</span><span class="token punctuation">(</span>newNode <span class="token operator">==</span> someNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>
<span class="token comment">// 插入最后一个子节点前面</span>
returnedNode <span class="token operator">=</span> someNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> someNode<span class="token punctuation">.</span>lastChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>newNode <span class="token operator">==</span> someNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>someNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol><li>replaceChild()方法接收两个参数：要插入的节点和要替换的节点。</li> <li>要替换的节点会被返回并从文档树中完全移除，要插入的节点会取而代之。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 替换第一个子节点</span>
<span class="token keyword">let</span> returnedNode <span class="token operator">=</span> someNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> someNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 替换最后一个子节点</span>
returnedNode <span class="token operator">=</span> someNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> someNode<span class="token punctuation">.</span>lastChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="移除节点-使用-removechild-方法"><a href="#移除节点-使用-removechild-方法" class="header-anchor">#</a> 移除节点 使用 removeChild()方法</h2> <p>removeChild()方法。这个方法接收一个参数，即要移除的节点。被移除的节点会被返回</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 删除第一个子节点</span>
<span class="token keyword">let</span> formerFirstChild <span class="token operator">=</span> someNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>someNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 删除最后一个子节点</span>
<span class="token keyword">let</span> formerLastChild <span class="token operator">=</span> someNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>someNode<span class="token punctuation">.</span>lastChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol><li>cloneNode()会返回与调用它的节点一模一样的节点。</li> <li>cloneNode()方法接收一个布尔值参数，表示是否深复制。</li> <li>复制返回的节点属于文档所有，但尚未指定父节点，所以可称为孤儿节点（orphan）。</li></ol> <p>使用cloneNode()方法的两种方式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> deepList <span class="token operator">=</span> myList<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>deepList<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3（IE9 之前的版本）或 7（其他浏览器）</span>
<span class="token keyword">let</span> shallowList <span class="token operator">=</span> myList<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>shallowList<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意 cloneNode()方法不会复制添加到 DOM 节点的 JavaScript 属性，比如事件处理程
序。这个方法只复制 HTML 属性，以及可选地复制子节点。除此之外则一概不会复制。
IE 在很长时间内会复制事件处理程序，这是一个 bug，所以推荐在复制前先删除事件处
理程序。</p></div> <h2 id="normalize"><a href="#normalize" class="header-anchor">#</a> normalize()</h2> <p>这个方法唯一的任务就是处理文档子树中的文本节点。</p> <p>在节点上调用 normalize()方法会检测这个节点的所有后代</p> <ol><li>如果发现空文本节点，则将其删除；</li> <li>如果两个同胞节点是相邻的，则将其合并为一个文本节点。</li></ol> <h2 id="document-类型"><a href="#document-类型" class="header-anchor">#</a> Document 类型</h2> <p>Document 类型是 JavaScript 中表示文档节点的类型</p> <ol><li>在浏览器中，文档对象 document 是HTMLDocument 的实例（HTMLDocument 继承 Document），表示整个 HTML 页面。</li> <li>document 是 window对象的属性，因此是一个全局对象。</li></ol> <p>Document 类型的节点有以下特征：
</p> <ol><li>等于 9； </li> <li>nodeName 值为&quot;#document&quot;； </li> <li>nodeValue 值为 null； </li> <li>parentNode 值为 null； </li> <li>ownerDocument 值为 null； </li> <li>子节点可以是 DocumentType（最多一个）、Element（最多一个）、ProcessingInstruction或 Comment 类型。</li></ol> <h2 id="文档子节点"><a href="#文档子节点" class="header-anchor">#</a> 文档子节点</h2> <p>提供了两个访问子节点的快捷方式</p> <ol><li>第一个是 documentElement 属性，始终指向 HTML 页面中的<code>&lt;html&gt;</code>元素。</li> <li>虽然 document.childNodes 中始终有<code>&lt;html&gt;</code>元素</li></ol> <p><code>&lt;html&gt;</code>元素。</p> <p>这个元素既可以通过documentElement 属性获取，也可以通过 childNodes 列表访问</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> html <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">;</span> <span class="token comment">// 取得对&lt;html&gt;的引用</span>
<span class="token function">alert</span><span class="token punctuation">(</span>html <span class="token operator">===</span> document<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>
<span class="token function">alert</span><span class="token punctuation">(</span>html <span class="token operator">===</span> document<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>&lt;body&gt;</code>元素</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">;</span> <span class="token comment">// 取得对&lt;body&gt;的引用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>所有主流浏览器都支持 document.documentElement 和 document.body。</p></blockquote> <p>Document 类型另一种可能的子节点是 DocumentType。
<code>&lt;!doctype&gt;</code>标签是文档中独立的部分，其信息可以通过 doctype 属性（在浏览器中是 document.doctype）来访问</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> doctype <span class="token operator">=</span> document<span class="token punctuation">.</span>doctype<span class="token punctuation">;</span> <span class="token comment">// 取得对&lt;!doctype&gt;的引用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>严格来讲出现在<code>&lt;html&gt;</code>元素外面的注释也是文档的子节点，它们的类型是 Comment。</p></blockquote> <h2 id="文档信息"><a href="#文档信息" class="header-anchor">#</a> 文档信息</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 读取文档标题</span>
<span class="token keyword">let</span> originalTitle <span class="token operator">=</span> document<span class="token punctuation">.</span>title<span class="token punctuation">;</span> 
<span class="token comment">// 修改文档标题</span>
document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;New page title&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol><li>URL 包含当前页面的完整 URL（地址栏中的 URL）</li> <li>domain 包含页面的域名</li> <li>referrer 包含链接到当前页面的那个页面的 URL(如果当前页面没有来源，则 referrer 属性包含空字符串。)</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 取得完整的 URL </span>
<span class="token keyword">let</span> url <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">;</span> 
<span class="token comment">// 取得域名</span>
<span class="token keyword">let</span> domain <span class="token operator">=</span> document<span class="token punctuation">.</span>domain<span class="token punctuation">;</span> 
<span class="token comment">// 取得来源</span>
<span class="token keyword">let</span> referrer <span class="token operator">=</span> document<span class="token punctuation">.</span>referrer<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="定位元素"><a href="#定位元素" class="header-anchor">#</a> 定位元素</h2> <p><code>getElementById()</code>和 <code>getElementsByTagName()</code>就是 Document 类型提供的两个方法。</p> <ol><li>getElementById()方法接收一个参数，即要获取元素的 ID，如果找到了则返回这个元素，如果没找到则返回 null。</li> <li>getElementsByTagName()获取元素引用的方法。这个方法接收一个参数，即要获取元素的标签名，返回包含零个或多个元素的 NodeList。</li></ol> <p>在 HTML 文档中，这个方法返回一个HTMLCollection 对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> images <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这里把返回的 HTMLCollection 对象保存在了变量 images 中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span>images<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 图片数量</span>
<span class="token function">alert</span><span class="token punctuation">(</span>images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一张图片的 src 属性</span>
<span class="token function">alert</span><span class="token punctuation">(</span>images<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 同上</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>HTMLCollection 对象还有一个额外的方法 namedItem()，可通过标签的 name 属性取得某一项
的引用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;myimage.gif&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;myImage&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">let</span> myImage <span class="token operator">=</span> images<span class="token punctuation">.</span><span class="token function">namedItem</span><span class="token punctuation">(</span><span class="token string">&quot;myImage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> myImage <span class="token operator">=</span> images<span class="token punctuation">[</span><span class="token string">&quot;myImage&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>要取得文档中的所有元素，可以给 <span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>传入<span class="token operator">*</span>。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>getElementsByName()方法会返回具有给定 name 属性的所有元素。</p> <blockquote><p>getElementsByName()方法最常用于单选按钮</p></blockquote> <h2 id="特殊集合"><a href="#特殊集合" class="header-anchor">#</a> 特殊集合</h2> <p>都是 HTMLCollection 的实例</p> <ol><li>document.anchors 包含文档中所有带 name 属性的<code>&lt;a&gt;</code>元素。</li> <li>document.forms 包含文档中所有<code>&lt;form&gt;</code>元素</li> <li>document.images 包含文档中所有<code>&lt;img&gt;</code>元素</li> <li>document.links 包含文档中所有带 href 属性的<code>&lt;a&gt;</code>元素。</li></ol> <h2 id="dom-兼容性检测"><a href="#dom-兼容性检测" class="header-anchor">#</a> DOM 兼容性检测</h2> <ul><li>DOM Level 1 在 document.implementation 上只定义了一个方法，即 hasFeature()。</li> <li>这个方法接收两个参数：特性名称和 DOM 版本。</li> <li>如果浏览器支持指定的特性和版本，则 hasFeature()方法返回true</li></ul> <p>支持指定的特性和版本</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> hasXmlDom <span class="token operator">=</span> document<span class="token punctuation">.</span>implementation<span class="token punctuation">.</span><span class="token function">hasFeature</span><span class="token punctuation">(</span><span class="token string">&quot;XML&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>hasFeature()目前这个方法已经被废弃</p> <h2 id="文档写入"><a href="#文档写入" class="header-anchor">#</a> 文档写入</h2> <p>向网页输出流中写入内容。对应 4 个方法：write()、writeln()、open()和 close()。</p> <ol><li>write()和 writeln()方法都接收一个字符串参数</li> <li>write()简单地写入文本</li> <li>writeln()还会在字符串末尾追加一个换行符（\n）</li></ol> <p>使用了 window.onload 事件处理程序，将调用 document.write()的函数推迟到页面加载完毕后执行。会重写整个页面内容。</p> <p>open()和 close()方法分别用于打开和关闭网页输出流。</p> <h2 id="element-类型"><a href="#element-类型" class="header-anchor">#</a> Element 类型</h2> <p>Element 类型的节点具有以下特征：</p> <ol><li>nodeType 等于 1；</li> <li>nodeName 值为元素的标签名；</li> <li>nodeValue 值为 null；</li> <li>parentNode 值为 Document 或 Element 对象；</li> <li>子节点可以是 Element、Text、Comment、ProcessingInstruction、CDATASection、EntityReference 类型</li></ol> <p>取得这个元素的标签名：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;myDiv&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;DIV&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>tagName <span class="token operator">==</span> div<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li>在 HTML 中，元素标签名始终以全大写表示</li> <li>在 XML（包括 XHTML）中，标签名始终与源代码中的大小写一致.</li></ol> <h2 id="html-元素"><a href="#html-元素" class="header-anchor">#</a> HTML 元素</h2> <ol><li>id，元素在文档中的唯一标识符；</li> <li>title，包含元素的额外信息，通常以提示条形式展示；</li> <li>lang，元素内容的语言代码（很少用）；</li> <li>dir，语言的书写方向（&quot;ltr&quot;表示从左到右，&quot;rtl&quot;表示从右到左，同样很少用）；</li> <li>className，相当于 class 属性，用于指定元素的 CSS 类</li></ol> <h2 id="取得属性"><a href="#取得属性" class="header-anchor">#</a> 取得属性</h2> <p>DOM 方法主要有 3 个：getAttribute()、setAttribute()和 removeAttribute()</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;myDiv&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果 不存在，返回null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>根据 HTML5 规范的要求，自定义属性名应该前缀 <code>data-</code> 以方便验证。</p></div> <ol><li>在使用 getAttribute()访问 style 属性时，返回的是 CSS 字符串。</li> <li>在通过 DOM 对象的属性访问时，style 属性返回的是一个（CSSStyleDeclaration）对象。</li> <li>getAttribute()访问事件属性，则返回的是字符串形式的源代码。</li> <li>通过 DOM 对象的属性访问事件属性时返回的则是一个 JavaScript函数（未指定该属性则返回 null）。</li></ol> <blockquote><p>getAttribute()主要用于取得自定义属性的值。</p></blockquote> <h2 id="设置属性"><a href="#设置属性" class="header-anchor">#</a> 设置属性</h2> <p>setAttribute()，这个方法接收两个参数：要设置的属性名和属性的值。</p> <ol><li>如果属性已经存在，则 setAttribute()会以指定的值替换原来的值；</li> <li>如果属性不存在，则 setAttribute()会以指定的值创建该属性。</li> <li>setAttribute()适用于 HTML 属性，也适用于自定义属性。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;someOtherId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ft&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Some other text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;lang&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;fr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;dir&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rtl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">&quot;someOtherId&quot;</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>align <span class="token operator">=</span> <span class="token string">&quot;left&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意，在 DOM 对象上添加自定义属性，如下面的例子所示，不会自动让它变成元素的属性</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code>div<span class="token punctuation">.</span>mycolor <span class="token operator">=</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;mycolor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null（IE 除外）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>removeAttribute()用于从元素中删除属性</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>div<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="attributes-属性"><a href="#attributes-属性" class="header-anchor">#</a> attributes 属性</h2> <ol><li>Element 类型是唯一使用 attributes 属性的 DOM 节点类型。</li> <li>元素的每个属性都表示为一个 Attr 节点，并保存在这个 NamedNodeMap 对象中。</li></ol> <p>NamedNodeMap 对象包含下列方法：</p> <ol><li>getNamedItem(name)，返回 nodeName 属性等于 name 的节点；</li> <li>removeNamedItem(name)，删除 nodeName 属性等于 name 的节点；</li> <li>setNamedItem(node)，向列表中添加 node 节点，以其 nodeName 为索引；</li> <li>item(pos)，返回索引位置 pos 处的节点。</li></ol> <p>取得元素 id 属性的值，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> id <span class="token operator">=</span> element<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span><span class="token function">getNamedItem</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>

<span class="token comment">// 使用中括号访问属性的简写形式</span>
<span class="token keyword">let</span> id <span class="token operator">=</span> element<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>设置属性的值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>element<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue <span class="token operator">=</span> <span class="token string">&quot;someOtherId&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除属性</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> oldAttr <span class="token operator">=</span> element<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span><span class="token function">removeNamedItem</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>接收一个属性节点，然后给元素添加一个新属性</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>element<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span><span class="token function">setNamedItem</span><span class="token punctuation">(</span>newAttr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>getAttribute()、removeAttribute()和 setAttribute()方法</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>attributes 属性最有用的场景是需要迭代元素上所有属性的时候。</p></div> <h2 id="创建元素"><a href="#创建元素" class="header-anchor">#</a> 创建元素</h2> <p>document.createElement()方法创建新元素,会将其 ownerDocument 属性设置为 document</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="元素后代"><a href="#元素后代" class="header-anchor">#</a> 元素后代</h2> <p>childNodes属性包含元素所有的子节点，这些子节点可能是其他元素、文本节点、注释或处理指令。</p> <p>检测一下节点的 nodeType：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> element<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeType <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 执行某个操作 Element节点</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="text-类型"><a href="#text-类型" class="header-anchor">#</a> Text 类型</h2> <p>Text 节点由 Text 类型表示</p> <p>Text 类型的节点具有以下特征：</p> <ol><li>nodeType 等于 3；</li> <li>nodeName 值为&quot;#text&quot;；</li> <li>nodeValue 值为节点中包含的文本；</li> <li>parentNode 值为 Element 对象；</li> <li>不支持子节点。</li></ol> <p>Text 节点中包含的文本可以通过 nodeValue 属性访问，也可以通过 data 属性访问，这两个属性包含相同的值</p> <ol><li>appendData(text)，向节点末尾添加文本 text；</li> <li>deleteData(offset, count)，从位置 offset 开始删除 count 个字符；</li> <li>insertData(offset, text)，在位置 offset 插入 text；</li> <li>replaceData(offset, count, text)，用 text 替换从位置 offset 到 offset + count 的文本；</li> <li>splitText(offset)，在位置 offset 将当前文本节点拆分为两个文本节点；</li> <li>substringData(offset, count)，提取从位置 offset 到 offset + count 的文本。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 取得文本节点的引用</span>
<span class="token keyword">let</span> textNode <span class="token operator">=</span> div<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span> <span class="token comment">// 或 div.childNodes[0]</span>
div<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>nodeValue <span class="token operator">=</span> <span class="token string">&quot;Some other message&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 输出为&quot;Some &amp;lt;strong&amp;gt;other&amp;lt;/strong&amp;gt; message&quot; </span>
div<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>nodeValue <span class="token operator">=</span> <span class="token string">&quot;Some &lt;strong&gt;other&lt;/strong&gt; message&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="创建文本节点"><a href="#创建文本节点" class="header-anchor">#</a> 创建文本节点</h2> <p>document.createTextNode()可以用来创建新文本节点，它接收一个参数，即要插入节点的文本。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;strong&gt;Hello&lt;/strong&gt; world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加了一段文本消息：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
element<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textNode<span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="规范化文本节点"><a href="#规范化文本节点" class="header-anchor">#</a> 规范化文本节点</h2> <p>normalize()，是在 Node 类型中定义的（因此所有类型的节点上都有这个方法）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
element<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textNode<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> anotherTextNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Yippee!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>anotherTextNode<span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 </span>
element<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 </span>
<span class="token function">alert</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Hello world!Yippee!&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="拆分文本节点"><a href="#拆分文本节点" class="header-anchor">#</a> 拆分文本节点</h2> <p>splitText(),可以在指定的偏移位置拆分 nodeValue，将一个文本节点拆分成两个文本节点。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>新文本节点包含剩下的文本</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
element<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textNode<span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> newNode <span class="token operator">=</span> element<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">splitText</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Hello&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>newNode<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot; world!&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="comment-类型"><a href="#comment-类型" class="header-anchor">#</a> Comment 类型</h2> <p>DOM 中的注释通过 Comment 类型表示。Comment 类型的节点具有以下特征：</p> <ol><li>nodeType 等于 8；</li> <li>nodeName 值为&quot;#comment&quot;；</li> <li>nodeValue 值为注释的内容；</li> <li>parentNode 值为 Document 或 Element 对象；</li> <li>不支持子节点。</li></ol> <p>访问它：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;myDiv&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">A</span> comment <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> comment <span class="token operator">=</span> div<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;A comment&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以使用 document.createComment()方法创建注释节点，参数为注释文本</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> comment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createComment</span><span class="token punctuation">(</span><span class="token string">&quot;A comment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="cdatasection-类型"><a href="#cdatasection-类型" class="header-anchor">#</a> CDATASection 类型</h2> <ol><li>CDATASection 类型表示 XML 中特有的 CDATA 区块。</li> <li>CDATASection 类型继承 Text 类型，因此拥有包括 splitText()在内的所有字符串操作方法。</li></ol> <p>CDATASection 类型的节点具有以下特征：</p> <ol><li>nodeType 等于 4；</li> <li>nodeName 值为&quot;#cdata-section&quot;；</li> <li>nodeValue 值为 CDATA 区块的内容；</li> <li>parentNode 值为 Document 或 Element 对象；</li> <li>不支持子节点</li></ol> <p>CDATA 区块只在 XML 文档中有效</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;myDiv&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>This is some content<span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在真正的 XML 文档中，可以使用 document.createCDataSection()并传入节点内容来创建CDATA 区块。</p> <h2 id="documenttype-类型"><a href="#documenttype-类型" class="header-anchor">#</a> DocumentType 类型</h2> <p>DocumentType 类型的节点包含文档的文档类型（doctype）信息，具有以下特征：</p> <ol><li>nodeType 等于 10；</li> <li>nodeName 值为文档类型的名称；</li> <li>nodeValue 值为 null；</li> <li>parentNode 值为 Document 对象；</li> <li>不支持子节点。</li></ol> <p>DocumentType 对象保存在 document.doctype 属性中</p> <p>DOM Level 1 规定了DocumentType 对象的 3 个属性：name、entities 和 notations。</p> <ol><li>name 是文档类型的名称</li> <li>entities 是这个文档类型描述的实体的 NamedNodeMap</li> <li>notations 是这个文档类型描述的表示法的 NamedNodeMap</li></ol> <p>因为浏览器中的文档通常是 HTML 或 XHTML 文档类型，所以 entities 和notations 列表为空。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> <span class="token constant">HTML</span> <span class="token constant">PUBLIC</span> <span class="token string">&quot;-// W3C// DTD HTML 4.01// EN&quot;</span> 
 <span class="token string">&quot;http:// www.w3.org/TR/html4/strict.dtd&quot;</span><span class="token operator">&gt;</span> 
对于这个文档类型，name 属性的值是<span class="token string">&quot;html&quot;</span>：
<span class="token function">alert</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>doctype<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;html&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="documentfragment-类型"><a href="#documentfragment-类型" class="header-anchor">#</a> DocumentFragment 类型</h2> <p>DocumentFragment 类型是唯一一个在标记中没有对应表示的类型。</p> <p>DocumentFragment 节点具有以下特征：
</p> <ol><li>nodeType 等于 11； </li> <li>nodeName 值为&quot;#document-fragment&quot;； </li> <li>nodeValue 值为 null； </li> <li>parentNode 值为 null； </li> <li>子节点可以是 Element、ProcessingInstruction、Comment、Text、CDATASection 或EntityReference。</li></ol> <p>创建文档片段：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以通过 appendChild()或 insertBefore()方法将文档片段的内容添加到文档。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 <span class="token keyword">let</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 li<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Item </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="attr-类型"><a href="#attr-类型" class="header-anchor">#</a> Attr 类型</h2> <ol><li>元素数据在 DOM 中通过 Attr 类型表示。</li> <li>Attr 类型构造函数和原型在所有浏览器中都可以直接访问。</li></ol> <p>Attr 节点具有以下特征：</p> <ol><li>nodeType 等于 2；</li> <li>nodeName 值为属性名；</li> <li>nodeValue 值为属性值；</li> <li>parentNode 值为 null；</li> <li>在 HTML 中不支持子节点</li> <li>在 XML 中子节点可以是 Text 或 EntityReference。</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Attr 节点很少直接被引用</p></div> <p>getAttribute()、removeAttribute()和 setAttribute()方法操作属性。</p> <blockquote><p>Attr 对象上有 3 个属性：name、value 和 specified。</p></blockquote> <ol><li>name 包含属性名（与 nodeName一样）</li> <li>value 包含属性值（与 nodeValue 一样）</li> <li>specified 是一个布尔值，表示属性使用的是默认值还是被指定的值。</li></ol> <p>可以使用 document.createAttribute()方法创建新的 Attr 节点，参数为属性名</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> attr <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;align&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
attr<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;left&quot;</span><span class="token punctuation">;</span> 
element<span class="token punctuation">.</span><span class="token function">setAttributeNode</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span><span class="token string">&quot;align&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;left&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getAttributeNode</span><span class="token punctuation">(</span><span class="token string">&quot;align&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;left&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;align&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;left&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="dom-编程"><a href="#dom-编程" class="header-anchor">#</a> DOM 编程</h2> <p>通过 HTML 代码能实现的，也一样能通过 JavaScript 实现。</p> <h3 id="动态脚本"><a href="#动态脚本" class="header-anchor">#</a> 动态脚本</h3> <p>有两种方式通过<code>&lt;script&gt;</code>动态为网页添加脚本：引入外部文件和直接插入源代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;foo.js&quot;</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>抽象为一个函数:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	script<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
	document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>怎么能知道脚本什么时候加载完？这个问题并没有标准答案。</p></blockquote> <p>另一个动态插入 JavaScript 的方式是嵌入源代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
script<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;function sayHi(){alert('hi');}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>IE 对<code>&lt;script&gt;</code>元素做了特殊处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
script<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">&quot;function sayHi(){alert('hi');}&quot;</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>兼容：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> code <span class="token operator">=</span> <span class="token string">&quot;function sayHi(){alert('hi');}&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">try</span> <span class="token punctuation">{</span> 
 script<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">{</span> 
 script<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>抽象出一个跨浏览器的函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadScriptString</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">;</span> 
 <span class="token keyword">try</span> <span class="token punctuation">{</span> 
 script<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">{</span> 
 script<span class="token punctuation">.</span>text <span class="token operator">=</span> code<span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
 document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="动态样式"><a href="#动态样式" class="header-anchor">#</a> 动态样式</h2> <ol><li><code>&lt;link&gt;</code>元素用于包含 CSS 外部文件</li> <li><code>&lt;style&gt;</code>元素用于添加嵌入样式。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;text/css&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;styles.css&quot;</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;link&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
link<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">;</span> 
link<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;text/css&quot;</span><span class="token punctuation">;</span> 
link<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;styles.css&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> head <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;head&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>通用函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadStyles</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">creatElement</span><span class="token punctuation">(</span><span class="token string">&quot;link&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	link<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">;</span>
	link<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;text/css&quot;</span><span class="token punctuation">;</span>
	link<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
	<span class="token keyword">let</span> head <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;head&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
style<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;text/css&quot;</span><span class="token punctuation">;</span> 
style<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;body{background-color:red}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> head <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;head&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>对于 IE，解决方案是访问元素的 styleSheet 属性，这个属性又有一个 cssText 属性，然后给这个属性添加 CSS 代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
style<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;text/css&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">try</span><span class="token punctuation">{</span> 
 style<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;body{background-color:red}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">{</span> 
 style<span class="token punctuation">.</span>styleSheet<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token string">&quot;body{background-color:red}&quot;</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">let</span> head <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;head&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>通用函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadStyleString</span><span class="token punctuation">(</span><span class="token parameter">css</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token keyword">let</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 style<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;text/css&quot;</span><span class="token punctuation">;</span> 
 <span class="token keyword">try</span><span class="token punctuation">{</span> 
 style<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>css<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">{</span> 
 style<span class="token punctuation">.</span>styleSheet<span class="token punctuation">.</span>cssText <span class="token operator">=</span> css<span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
 <span class="token keyword">let</span> head <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;head&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
 head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意 对于 IE，要小心使用 styleSheet.cssText。如果重用同一个<code>&lt;style&gt;</code>元素并设
置该属性超过一次，则可能导致浏览器崩溃。同样，将 cssText 设置为空字符串也可能
导致浏览器崩溃。</p></div> <h2 id="操作表格"><a href="#操作表格" class="header-anchor">#</a> 操作表格</h2> <p>创建<code>&lt;table&gt;</code>元素,包括表行、表元、表题，等等。</p> <p>创建以下 HTML 表格：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>table border<span class="token operator">=</span><span class="token string">&quot;1&quot;</span> width<span class="token operator">=</span><span class="token string">&quot;100%&quot;</span><span class="token operator">&gt;</span> 
 <span class="token operator">&lt;</span>tbody<span class="token operator">&gt;</span> 
	 <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span> 
		 <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span>Cell <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span> 
		 <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span>Cell <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span> 
	 <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span> 
	 <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span> 
		 <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span>Cell <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span> 
		 <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span>Cell <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span> 
	 <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span> 
 <span class="token operator">&lt;</span><span class="token operator">/</span>tbody<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建表格</span>
<span class="token keyword">let</span> table <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;table&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
table<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
table<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">&quot;100%&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建表体</span>
<span class="token keyword">let</span> tbody <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;tbody&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
table<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>tbody<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建第一行</span>
<span class="token keyword">let</span> row1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;tr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>row1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> cell1_1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;td&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
cell1_1<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Cell 1,1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
row1<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>cell1_1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> cell2_1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;td&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
cell2_1<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Cell 2,1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
row1<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>cell2_1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建第二行</span>
<span class="token keyword">let</span> row2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;tr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>row2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> cell1_2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;td&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
cell1_2<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Cell 1,2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
row2<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>cell1_2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> cell2_2<span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;td&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
cell2_2<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Cell 2,2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
row2<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>cell2_2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 把表格添加到文档主体</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><code>&lt;table&gt;</code>元素添加了以下属性和方法：</p> <ul><li>caption，指向<code>&lt;caption&gt;</code>元素的指针（如果存在）；</li> <li>tBodies，包含<code>&lt;tbody&gt;</code>元素的 HTMLCollection； </li> <li>tFoot，指向<code>&lt;tfoot&gt;</code>元素（如果存在）；</li> <li>tHead，指向<code>&lt;thead&gt;</code>元素（如果存在）；</li> <li>rows，包含表示所有行的 HTMLCollection； </li> <li>createTHead()，创建<code>&lt;thead&gt;</code>元素，放到表格中，返回引用；</li> <li>createTFoot()，创建<code>&lt;tfoot&gt;</code>元素，放到表格中，返回引用；</li> <li>createCaption()，创建<code>&lt;caption&gt;</code>元素，放到表格中，返回引用；</li> <li>deleteTHead()，删除<code>&lt;thead&gt;</code>元素；</li> <li>deleteTFoot()，删除<code>&lt;tfoot&gt;</code>元素；</li> <li>deleteCaption()，删除<code>&lt;caption&gt;</code>元素；</li> <li>deleteRow(pos)，删除给定位置的行；</li> <li>insertRow(pos)，在行集合中给定位置插入一行。</li></ul> <p><code>&lt;tbody&gt;</code>元素添加了以下属性和方法：
</p> <ul><li>rows，包含<code>&lt;tbody&gt;</code>元素中所有行的 HTMLCollection；</li> <li>deleteRow(pos)，删除给定位置的行；</li> <li>insertRow(pos)，在行集合中给定位置插入一行，返回该行的引用。</li></ul> <p><code>&lt;tr&gt;</code>元素添加了以下属性和方法：</p> <ul><li>cells，包含<code>&lt;tr&gt;</code>元素所有表元的 HTMLCollection； </li> <li>deleteCell(pos)，删除给定位置的表元；</li> <li>insertCell(pos)，在表元集合给定位置插入一个表元，返回该表元的引用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建表格</span>
<span class="token keyword">let</span> table <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;table&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
table<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
table<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">&quot;100%&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建表体</span>
<span class="token keyword">let</span> tbody <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;tbody&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
table<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>tbody<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建第一行</span>
tbody<span class="token punctuation">.</span><span class="token function">insertRow</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">insertCell</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cells<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Cell 1,1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">insertCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cells<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Cell 2,1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建第二行</span>
tbody<span class="token punctuation">.</span><span class="token function">insertRow</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">insertCell</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cells<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Cell 1,2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">insertCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
tbody<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cells<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;Cell 2,2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 把表格添加到文档主体</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="使用-nodelist"><a href="#使用-nodelist" class="header-anchor">#</a> 使用 NodeList</h2> <p>NodeList 对象和相关的 NamedNodeMap、HTMLCollection</p> <p>3 个集合类型都是“实时的”，意味着文档结构的变化会实时地在它们身上反映出来，因此它们的值始终代表最新的状态</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> divs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 <span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> divs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 <span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>一般来说，最好限制操作 NodeList 的次数。因为每次查询都会搜索整个文档，所以最好把查询到
的 NodeList 缓存起来。</p></div> <h2 id="mutationobserver-接口"><a href="#mutationobserver-接口" class="header-anchor">#</a> MutationObserver 接口</h2> <p>DOM 规范中的 MutationObserver 接口，可以在 DOM 被修改时异步执行回调。</p> <h3 id="基本用法"><a href="#基本用法" class="header-anchor">#</a> 基本用法</h3> <p>MutationObserver 的实例要通过调用 MutationObserver 构造函数并传入一个回调函数来创建：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DOM was mutated!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="observe-方法"><a href="#observe-方法" class="header-anchor">#</a> observe()方法</h3> <p>新创建的 MutationObserver 实例不会关联 DOM 的任何部分。要把这个 observer 与 DOM 关
联起来，需要使用 observe()方法。这个方法接收两个必需的参数：要观察其变化的 DOM 节点，以及
一个 MutationObserverInit 对象。</p> <p>MutationObserverInit 对象用于控制观察哪些方面的变化，是一个键/值对形式配置选项的字典。</p> <p>例如，下面的代码会创建一个观察者（observer）并配置它观察<code>&lt;body&gt;</code>元素上的属性变化：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&lt;body&gt; attributes changed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&lt;body&gt; attributes changed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Changed body class'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// Changed body class </span>
<span class="token comment">// &lt;body&gt; attributes changed</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="回调与-mutationrecord"><a href="#回调与-mutationrecord" class="header-anchor">#</a> 回调与 MutationRecord</h3> <p>每个回调都会收到一个 MutationRecord 实例的数组。MutationRecord 实例包含的信息包括发
生了什么变化，以及 DOM 的哪一部分受到了影响。因为回调执行之前可能同时发生多个满足观察条件
的事件，所以每次执行回调都会传入一个包含按顺序入队的 MutationRecord 实例的数组。
下面展示了反映一个属性变化的 MutationRecord 实例的数组：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [ </span>
<span class="token comment">// { </span>
<span class="token comment">// addedNodes: NodeList [],</span>
<span class="token comment">// attributeName: &quot;foo&quot;, </span>
<span class="token comment">// attributeNamespace: null, </span>
<span class="token comment">// nextSibling: null, </span>
<span class="token comment">// oldValue: null, </span>
<span class="token comment">// previousSibling: null </span>
<span class="token comment">// removedNodes: NodeList [], </span>
<span class="token comment">// target: body </span>
<span class="token comment">// type: &quot;attributes&quot; </span>
<span class="token comment">// } </span>
<span class="token comment">// ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>涉及命名空间的类似变化：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttributeNS</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [ </span>
<span class="token comment">// { </span>
<span class="token comment">// addedNodes: NodeList [], </span>
<span class="token comment">// attributeName: &quot;foo&quot;, </span>
<span class="token comment">// attributeNamespace: &quot;baz&quot;, </span>
<span class="token comment">// nextSibling: null, </span>
<span class="token comment">// oldValue: null, </span>
<span class="token comment">// previousSibling: null </span>
<span class="token comment">// removedNodes: NodeList [], </span>
<span class="token comment">// target: body </span>
<span class="token comment">// type: &quot;attributes&quot; </span>
<span class="token comment">// } </span>
<span class="token comment">// ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>变化事件发生的顺序：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'baz'</span><span class="token punctuation">;</span> 
<span class="token comment">// [MutationRecord, MutationRecord, MutationRecord]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>MutationRecord 实例的属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>target 
被修改影响的目标节点

type 
字符串，表示变化的类型：<span class="token string">&quot;attributes&quot;</span>、<span class="token string">&quot;characterData&quot;</span>或<span class="token string">&quot;childList&quot;</span>

oldValue 
如果在 MutationObserverInit 对象中启用（attributeOldValue 或 characterData OldValue
为 <span class="token boolean">true</span>），<span class="token string">&quot;attributes&quot;</span>或<span class="token string">&quot;characterData&quot;</span>的变化事件会设置这个属性为被替代的值
<span class="token string">&quot;childList&quot;</span>类型的变化始终将这个属性设置为 <span class="token keyword">null</span>

attributeName 
对于<span class="token string">&quot;attributes&quot;</span>类型的变化，这里保存被修改属性的名字
其他变化事件会将这个属性设置为 <span class="token keyword">null</span>

attributeNamespace 
对于使用了命名空间的<span class="token string">&quot;attributes&quot;</span>类型的变化，这里保存被修改属性的名字
其他变化事件会将这个属性设置为 <span class="token keyword">null</span>

addedNodes 
对于<span class="token string">&quot;childList&quot;</span>类型的变化，返回包含变化中添加节点的 NodeList
默认为空 NodeList

removedNodes 
对于<span class="token string">&quot;childList&quot;</span>类型的变化，返回包含变化中删除节点的 NodeList
默认为空 NodeList

previousSibling 
对于<span class="token string">&quot;childList&quot;</span>类型的变化，返回变化节点的前一个同胞 Node 
默认为 <span class="token keyword">null</span>

nextSibling 
对于<span class="token string">&quot;childList&quot;</span>类型的变化，返回变化节点的后一个同胞 Node
默认为 <span class="token keyword">null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>传给回调函数的第二个参数是观察变化的 MutationObserver 的实例，演示如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords<span class="token punctuation">,</span> mutationObserver</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">,</span>
mutationObserver<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
<span class="token comment">// [MutationRecord], MutationObserver</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="disconnect-方法"><a href="#disconnect-方法" class="header-anchor">#</a> disconnect()方法</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&lt;body&gt; attributes changed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span> 
<span class="token comment">//（没有日志输出）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>要想让已经加入任务队列的回调执行，可以使用 setTimeout()让已经入列的回调执行完毕再调用
disconnect()：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&lt;body&gt; attributes changed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
 observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// &lt;body&gt; attributes changed</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="复用-mutationobserver"><a href="#复用-mutationobserver" class="header-anchor">#</a> 复用 MutationObserver</h3> <p>多次调用 observe()方法，可以复用一个 MutationObserver 对象观察多个不同的目标节点。
此时，MutationRecord 的 target 属性可以标识发生变化事件的目标节点。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
x<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 向页面主体添加两个子节点</span>
<span class="token keyword">let</span> childA <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 childB <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>childA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>childB<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 观察两个子节点</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>childA<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>childB<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 修改两个子节点的属性</span>
childA<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
childB<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [&lt;div&gt;, &lt;span&gt;] </span>
<span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法是一个“一刀切”的方案，调用它会停止观察所有目标：
<span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
x<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 向页面主体添加两个子节点</span>
<span class="token keyword">let</span> childA <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 childB <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>childA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>childB<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 观察两个子节点</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>childA<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>childB<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 修改两个子节点的属性</span>
childA<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
childB<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// （没有日志输出）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="重用-mutationobserver"><a href="#重用-mutationobserver" class="header-anchor">#</a> 重用 MutationObserver</h2> <p>调用 disconnect()并不会结束 MutationObserver 的生命。</p> <p>先断开然后又恢复了观察者与<code>&lt;body&gt;</code>元素的关联：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span> attributes 
changed'<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 这行代码会触发变化事件</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
 observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token comment">// 这行代码不会触发变化事件</span>
 document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
 <span class="token comment">// Reattach </span>
 observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token comment">// 这行代码会触发变化事件</span>
 document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'qux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// &lt;body&gt; attributes changed </span>
<span class="token comment">// &lt;body&gt; attributes changed</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="mutationobserverinit-与观察范围"><a href="#mutationobserverinit-与观察范围" class="header-anchor">#</a> MutationObserverInit 与观察范围</h3> <p>MutationObserverInit 对象用于控制对目标节点的观察范围。</p> <p>MutationObserverInit 对象的属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>subtree 
布尔值，表示除了目标节点，是否观察目标节点的子树（后代）
如果是 <span class="token boolean">false</span>，则只观察目标节点的变化；如果是 <span class="token boolean">true</span>，则观察目标节点及其整个子树
默认为 <span class="token boolean">false</span>

attributes 
布尔值，表示是否观察目标节点的属性变化
默认为 <span class="token boolean">false</span>

attributeFilter 
字符串数组，表示要观察哪些属性的变化
把这个值设置为 <span class="token boolean">true</span> 也会将 attributes 的值转换为 <span class="token boolean">true</span> 
默认为观察所有属性

attributeOldValue 
布尔值，表示 MutationRecord 是否记录变化之前的属性值
把这个值设置为 <span class="token boolean">true</span> 也会将 attributes 的值转换为 <span class="token boolean">true</span> 
默认为 <span class="token boolean">false</span>

characterData 
布尔值，表示修改字符数据是否触发变化事件
默认为 <span class="token boolean">false</span>

characterDataOldValue 
布尔值，表示 MutationRecord 是否记录变化之前的字符数据
把这个值设置为 <span class="token boolean">true</span> 也会将 characterData 的值转换为 <span class="token boolean">true</span> 
默认为 <span class="token boolean">false</span>

childList 
布尔值，表示修改目标节点的子节点是否触发变化事件
默认为 <span class="token boolean">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意 在调用 observe()时，MutationObserverInit 对象中的 attribute、characterData
和 childList 属性必须至少有一项为 true（无论是直接设置这几个属性，还是通过设置
attributeOldValue 等属性间接导致它们的值转换为 true）。否则会抛出错误，因为没
有任何变化事件可能触发回调。</p></div> <h2 id="观察属性"><a href="#观察属性" class="header-anchor">#</a> 观察属性</h2> <ol><li>MutationObserver 可以观察节点属性的添加、移除和修改。</li> <li>要为属性变化注册回调，需要在MutationObserverInit 对象中将 attributes 属性设置为 true</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 添加属性 </span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 修改属性</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 移除属性</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 以上变化都被记录下来了</span>
<span class="token comment">// [MutationRecord, MutationRecord, MutationRecord]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>使用 attributeFilter 属性来设置白名单，即一个属性名字符串数组：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributeFilter</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 添加白名单属性</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 添加被排除的属性</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'qux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 只有 foo 属性的变化被记录了</span>
<span class="token comment">// [MutationRecord]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果想在变化记录中保存属性原来的值，可以将 attributeOldValue 属性设置为 true：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>oldValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributeOldValue</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'qux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 每次变化都保留了上一次的值</span>
<span class="token comment">// [null, 'bar', 'baz']</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="观察字符数据"><a href="#观察字符数据" class="header-anchor">#</a> 观察字符数据</h2> <ol><li>MutationObserver 可以观察文本节点（如 Text、Comment 或 ProcessingInstruction 节点）中字符的添加、删除和修改。</li> <li>要为字符数据注册回调，需要在 MutationObserverInit 对象中将characterData 属性设置为 true</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建要观察的文本节点</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">characterData</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 赋值为相同的字符串</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
<span class="token comment">// 赋值为新字符串</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span> 
<span class="token comment">// 通过节点设置函数赋值</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'baz'</span><span class="token punctuation">;</span> 
<span class="token comment">// 以上变化都被记录下来了</span>
<span class="token comment">// [MutationRecord, MutationRecord, MutationRecord]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如果想在变化记录中保存原来的字符数据，可以将 characterDataOldValue 属性设置为</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>oldValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">characterDataOldValue</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'baz'</span><span class="token punctuation">;</span> 
<span class="token comment">// 每次变化都保留了上一次的值</span>
<span class="token comment">// [&quot;foo&quot;, &quot;foo&quot;, &quot;bar&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="观察子节点"><a href="#观察子节点" class="header-anchor">#</a> 观察子节点</h2> <p>MutationObserver 可以观察目标节点子节点的添加和移除。要观察子节点，需要在 MutationObserverInit 对象中将 childList 属性设置为 true。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 清空主体</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [ </span>
<span class="token comment">// { </span>
<span class="token comment">// addedNodes: NodeList[div], </span>
<span class="token comment">// attributeName: null, </span>
<span class="token comment">// attributeNamespace: null, </span>
<span class="token comment">// oldValue: null, </span>
<span class="token comment">// nextSibling: null, </span>
<span class="token comment">// previousSibling: null, </span>
<span class="token comment">// removedNodes: NodeList[], </span>
<span class="token comment">// target: body, </span>
<span class="token comment">// type: &quot;childList&quot;, </span>
<span class="token comment">// } </span>
<span class="token comment">// ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>移除子节点：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 清空主体</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [ </span>
<span class="token comment">// { </span>
<span class="token comment">// addedNodes: NodeList[], </span>
<span class="token comment">// attributeName: null, </span>
<span class="token comment">// attributeNamespace: null, </span>
<span class="token comment">// oldValue: null, </span>
<span class="token comment">// nextSibling: null, </span>
<span class="token comment">// previousSibling: null, </span>
<span class="token comment">// removedNodes: NodeList[div], </span>
<span class="token comment">// target: body, </span>
<span class="token comment">// type: &quot;childList&quot;, </span>
<span class="token comment">// } </span>
<span class="token comment">// ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>对子节点重新排序</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 清空主体</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建两个初始子节点</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 交换子节点顺序</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>lastChild<span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 发生了两次变化：第一次是节点被移除，第二次是节点被添加</span>
<span class="token comment">// [ </span>
<span class="token comment">// { </span>
<span class="token comment">// addedNodes: NodeList[], </span>
<span class="token comment">// attributeName: null, </span>
<span class="token comment">// attributeNamespace: null, </span>
<span class="token comment">// oldValue: null, </span>
<span class="token comment">// nextSibling: null, </span>
<span class="token comment">// previousSibling: div, </span>
<span class="token comment">// removedNodes: NodeList[span], </span>
<span class="token comment">// target: body, </span>
<span class="token comment">// type: childList, </span>
<span class="token comment">// }, </span>
<span class="token comment">// { </span>
<span class="token comment">// addedNodes: NodeList[span], </span>
<span class="token comment">// attributeName: null, </span>
<span class="token comment">// attributeNamespace: null, </span>
<span class="token comment">// oldValue: null, </span>
<span class="token comment">// nextSibling: div, </span>
<span class="token comment">// previousSibling: null, </span>
<span class="token comment">// removedNodes: NodeList[], </span>
<span class="token comment">// target: body, </span>
<span class="token comment">// type: &quot;childList&quot;, </span>
<span class="token comment">// } </span>
<span class="token comment">// ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="观察子树"><a href="#观察子树" class="header-anchor">#</a> 观察子树</h2> <ol><li>默认情况下，MutationObserver 将观察的范围限定为一个元素及其子节点的变化。</li> <li>范围扩展到这个元素的子树（所有后代节点），这需要在 MutationObserverInit 对象中将 subtree属性设置为 true。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 清空主体</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建一个后代</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 观察&lt;body&gt;元素及其子树</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">subtree</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 修改&lt;body&gt;元素的子树</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 记录了子树变化的事件</span>
<span class="token comment">// [ </span>
<span class="token comment">// { </span>
<span class="token comment">// addedNodes: NodeList[], </span>
<span class="token comment">// attributeName: &quot;foo&quot;, </span>
<span class="token comment">// attributeNamespace: null, </span>
<span class="token comment">// oldValue: null, </span>
<span class="token comment">// nextSibling: null, </span>
<span class="token comment">// previousSibling: null, </span>
<span class="token comment">// removedNodes: NodeList[], </span>
<span class="token comment">// target: div, </span>
<span class="token comment">// type: &quot;attributes&quot;, </span>
<span class="token comment">// } </span>
<span class="token comment">// ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>被观察子树中的节点被移出子树之后仍然能够触发变化事件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 清空主体</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> subtreeRoot <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 subtreeLeaf <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 创建包含两层的子树</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>subtreeRoot<span class="token punctuation">)</span><span class="token punctuation">;</span> 
subtreeRoot<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>subtreeLeaf<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 观察子树</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>subtreeRoot<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">subtree</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 把节点转移到其他子树</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>subtreeLeaf<span class="token punctuation">,</span> subtreeRoot<span class="token punctuation">)</span><span class="token punctuation">;</span> 
subtreeLeaf<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 移出的节点仍然触发变化事件</span>
<span class="token comment">// [MutationRecord]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="异步回调与记录队列"><a href="#异步回调与记录队列" class="header-anchor">#</a> 异步回调与记录队列</h2> <p>MutationObserver 接口是出于性能考虑而设计的，其核心是异步回调与记录队列模型。</p> <p>为了在大量变化事件发生时不影响性能，每次变化的信息（由观察者实例决定）会保存在 MutationRecord实例中，然后添加到记录队列。</p> <p>这个队列对每个 MutationObserver 实例都是唯一的，是所有 DOM变化事件的有序列表</p> <h2 id="记录队列"><a href="#记录队列" class="header-anchor">#</a> 记录队列</h2> <p>每次 MutationRecord 被添加到 MutationObserver 的记录队列时，仅当之前没有已排期的微任
务回调时（队列中微任务长度为 0），才会将观察者注册的回调（在初始化 MutationObserver 时传入）
作为微任务调度到任务队列上。这样可以保证记录队列的内容不会被回调处理两次。</p> <p>在回调的微任务异步执行期间，有可能又会发生更多变化事件。因此被调用的回调会接收到一
个 MutationRecord 实例的数组，顺序为它们进入记录队列的顺序。回调要负责处理这个数组的每一
个实例，因为函数退出之后这些实现就不存在了。回调执行后，这些 MutationRecord 就用不着了，
因此记录队列会被清空，其内容会被丢弃。</p> <h3 id="takerecords-方法"><a href="#takerecords-方法" class="header-anchor">#</a> takeRecords()方法</h3> <p>调用 MutationObserver 实例的 takeRecords()方法可以清空记录队列，取出并返回其中的所
有 MutationRecord 实例</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span> 
 <span class="token punctuation">(</span><span class="token parameter">mutationRecords</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutationRecords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'baz'</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>observer<span class="token punctuation">.</span><span class="token function">takeRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>observer<span class="token punctuation">.</span><span class="token function">takeRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [MutationRecord, MutationRecord, MutationRecord] </span>
<span class="token comment">// []</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="性能、内存与垃圾回收"><a href="#性能、内存与垃圾回收" class="header-anchor">#</a> 性能、内存与垃圾回收</h2> <p>MutationObserver 实例与目标节点之间的引用关系是非对称的。MutationObserver 拥有对要
观察的目标节点的弱引用。因为是弱引用，所以不会妨碍垃圾回收程序回收目标节点。</p> <p>目标节点却拥有对 MutationObserver 的强引用。如果目标节点从 DOM 中被移除，随后
被垃圾回收，则关联的 MutationObserver 也会被垃圾回收。</p> <p>记录队列中的每个 MutationRecord 实例至少包含对已有 DOM 节点的一个引用。如果变化是
childList 类型，则会包含多个节点的引用。记录队列和回调处理的默认行为是耗尽这个队列，处理
每个 MutationRecord，然后让它们超出作用域并被垃圾回收</p> <ul><li>Node 是基准节点类型，是文档一个部分的抽象表示，所有其他类型都继承 Nod</li> <li>Document 类型表示整个文档，对应树形结构的根节点。在 JavaScript 中，document 对象是Document 的实例，拥有查询和获取节点的很多方法。</li> <li>Element 节点表示文档中所有 HTML 或 XML 元素，可以用来操作它们的内容和属性。</li> <li>其他节点类型分别表示文本内容、注释、文档类型、CDATA 区块和文档片段。</li> <li>NodeList 对象尤其需要注意。NodeList 对象是“实时更新”的，这意味着每次访问它都会执行一次新的查询。</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/webVueBlog/learn-web/edit/master/JavaScript-advanced-programming/14章-DOM.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2/16/2022, 3:08:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learn-web/JavaScript-advanced-programming/13章-客户端检测.html" class="prev">
        13章-客户端检测
      </a></span> <span class="next"><a href="/learn-web/JavaScript-advanced-programming/15章-DOM扩展.html">
        15章-DOM扩展
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----><!----><div></div></div></div>
    <script src="/learn-web/assets/js/app.72a02f74.js" defer></script><script src="/learn-web/assets/js/2.a6c2d1f7.js" defer></script><script src="/learn-web/assets/js/56.2dee655f.js" defer></script>
  </body>
</html>
